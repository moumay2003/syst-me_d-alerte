<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prévisions des opérations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        h1 { color: #333; }
        select, button { margin: 10px 0; padding: 5px; }
        #result { margin-top: 20px; }
        #graphic { max-width: 100%; height: auto; }
        #error-message, #exists-message { color: red; margin-top: 10px; }
        #loading { margin-top: 10px; color: blue; }
    </style>
</head>
<body>
    <h1>Prévisions des opérations</h1>

    <form id="forecast-form">
        {% csrf_token %}
        <label for="id_service">Sélectionnez un service :</label>
        <select id="id_service" name="id_service" required>
            <option value="">--Choisissez un service--</option>
            {% for service in services %}
                <option value="{{ service.id }}">{{ service.name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Générer les prévisions</button>
    </form>

    <div id="loading" style="display: none;">
        Chargement en cours...
    </div>

    <div id="error-message" style="display: none;">
    </div>

    <div id="exists-message" style="display: none;">
    </div>

    <div id="forecast-result">
        <img id="forecast-graph" src="" alt="Graphe des prévisions" style="display: none;">
    </div>

    <script>
    document.getElementById('forecast-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error-message');
        const existsDiv = document.getElementById('exists-message');
        const graphImg = document.getElementById('forecast-graph');
        
        loadingDiv.style.display = 'block';
        errorDiv.style.display = 'none';
        existsDiv.style.display = 'none';
        graphImg.style.display = 'none';
        
        fetch('{% url "forecast2" %}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            loadingDiv.style.display = 'none';
            if (data.status === 'success') {
                existsDiv.textContent = data.message; // Afficher le message concernant le modèle existant ou nouveau
                existsDiv.style.display = 'block';
                graphImg.src = 'data:image/png;base64,' + data.graphic;
                graphImg.style.display = 'block';
            } else {
                errorDiv.textContent = "Erreur : " + data.message;
                errorDiv.style.display = 'block';
            }
        })
        .catch(error => {
            loadingDiv.style.display = 'none';
            errorDiv.textContent = "Erreur lors de la requête : " + error.message;
            errorDiv.style.display = 'block';
        });
    });
    </script>
</body>
</html>
